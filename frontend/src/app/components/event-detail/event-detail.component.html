<div class="container" *ngIf="event$ | async as event; else loadingOrError">
    <div class="event-header" [style.background-image]="'url(' + (event.imageUrl || 'assets/placeholder.jpg') + ')'">
        <div class="header-content">
            <h1>{{ event.title }}</h1>
            <p class="date">{{ event.date | date:'fullDate' }}</p>
            <p class="location">{{ event.location }}</p>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="main-info">
            <div class="actions-bar" style="margin-bottom: 2rem; display: flex; gap: 1rem;">
                <button (click)="shareEvent()" class="btn btn-outline" style="border-color: #aaa; color: #fff;">
                    <i class="fas fa-share-alt"></i> Share Event
                </button>
            </div>

            <h2>About this event</h2>
            <p>{{ event.description }}</p>

            <div class="producer-section" *ngIf="event.producer">
                <h3>Organizer</h3>
                <div class="producer-card">
                    <img [src]="event.producer.profileImageUrl || 'assets/placeholder-avatar.jpg'" alt="Producer Avatar"
                        class="producer-avatar">
                    <div class="producer-details">
                        <h4>{{ event.producer.organizationName || event.producer.fullName }}</h4>
                        <p class="producer-desc">{{ event.producer.description || 'Verified Organizer' }}</p>
                        <a *ngIf="event.producer.website" [href]="event.producer.website" target="_blank"
                            class="producer-link">
                            Visit Website <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="tickets-sidebar">
            <h3>Select Tickets</h3>
            <div class="batch-list">
                <div class="batch-item" *ngFor="let batch of event.batches"
                    [class.selected]="selectedBatchId === batch.id" [class.sold-out]="isSoldOut(batch)"
                    (click)="!isSoldOut(batch) && selectBatch(batch.id)">
                    <div class="batch-info">
                        <span class="batch-name">{{ batch.name }}</span>
                        <span class="batch-price">\${{ batch.price }}</span>
                    </div>
                    <div class="batch-availability">
                        <span *ngIf="isSoldOut(batch)" class="badge-sold-out">SOLD OUT</span>
                        <span *ngIf="!isSoldOut(batch)">{{ batch.totalQuantity - (batch.soldQuantity || 0) }}
                            remaining</span>
                    </div>
                </div>
            </div>

            <div class="quantity-selector" *ngIf="selectedBatchId">
                <button (click)="decrement()" class="qty-btn">-</button>
                <span class="qty-val">{{ quantity }}</span>
                <button (click)="increment()" class="qty-btn">+</button>
            </div>

            <a [routerLink]="['/checkout']"
                [queryParams]="{ eventId: event.id, batchId: selectedBatchId, quantity: quantity }"
                class="btn btn-primary btn-full buy-btn" [class.disabled]="!selectedBatchId">
                Buy Tickets
            </a>
        </div>
    </div>
</div>

<ng-template #loadingOrError>
    <div class="container" style="text-align: center; margin-top: 5rem;">
        <h2>Loading event info...</h2>
        <p>If this takes too long, the event might not exist.</p>
        <a routerLink="/" class="btn btn-outline">Back to Home</a>
    </div>
</ng-template>